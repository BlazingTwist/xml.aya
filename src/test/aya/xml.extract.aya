require xml {xml}

[
    "<a>"
        "<b x=\"5\" y=\"6\">"
            "<c>1</c>"
            "<c>2</c>"
			"<c/>"
        "</b>"
        "<b x=\"7\" y=\"8\">"
            "<c>3</c>"
            "<c>4</c>"
			"<c/>"
        "</b>"
    "</a>"
] "" % :xml_str;

:{
	[
		:{
			[5 6]:attributes;
			[
				:{ ["1"]:value; }
				:{ ["2"]:value; }
				:{ []:value; }
			]:c;
		}
		:{
			[7 8]:attributes;
			[
				:{ ["3"]:value; }
				:{ ["4"]:value; }
				:{ []:value; }
			]:c;
		}
	]:b;
}:expected;

:{
	"text()":value;
}:type_c;

:{
	["@*" num] :attributes;
	["c" type_c] :c;
}:type_b;

:{
	["//b" type_b] :b;
}:type_root;


"test extracting values from xml":P
(xml_str 1 xml.loads type_root\ .extract) (expected) :!


.# detect unexpected operands on stack
.A :& E :& 0 > {
	.# stack has leak_stack::list len::num
	:{}
	\"Operand leak! There are "\+ " items on the stack. Expected 0"+ \.:["msg"]
	.:["stack"]
	.D
}{;}.?